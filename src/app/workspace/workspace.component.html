<div class="container-fluid g-0">

    <navbar [path]="getUrl()"></navbar>

    <div class="row p-2 g-0 gap-1">
        <div class="row g-0 gap-1">
            <div class="col-auto">
                <div class="badge bg-secondary" (click)="showNotification('default', 'Click en opciones')">Opciones</div>
            </div>
        </div>
        <div class="col-auto d-grid" *ngIf="getUrl().includes('?path=')">
            <button class="btn btn-sm btn-outline-secondary shadow-sm" (click)=goBack()>Volver<i class="bi bi-arrow-left-short ms-1"></i></button>
        </div>
        <div class="col-auto d-grid">
            <button class="btn btn-sm btn-outline-secondary shadow-sm" (click)="getContent(getUrl())">Actualizar<i class="bi bi-arrow-clockwise ms-1"></i></button>
        </div>
        <div class="col-auto d-grid">
            <button class="btn btn-sm btn-outline-secondary shadow-sm">Ver ultimas versiones<i class="bi bi-eye-fill ms-1"></i></button>
        </div>
        <div class="col-auto d-grid">
            <button class="btn btn-sm btn-outline-secondary shadow-sm" data-bs-toggle="modal" data-bs-target="#makeDirectoryModal">Crear una carpeta<i class="bi bi-folder-plus ms-1"></i></button>
        </div>
    </div>

    <div *ngIf="content" class="container-fluid">
        <div *ngIf="content.folders && content.folders.length > 0">
            <folders [folders]="content.folders" (folderEvent)="folderEvent($event)"></folders>
        </div>
        <div *ngIf="content.files && content.files.length > 0">
            <files [files]="content.files" [path]="getUrl()" (fileEvent)="fileEvent($event)"></files>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row g-0 gap-1 p-2">
            <label class="col d-grid" for="file">
                <div class="btn btn-sm btn-danger">
                    Selecciona un archivo
                </div>
                <input #fileInputField type="file" name="file" id="file" class="visually-hidden" (change)="checkExistence()">
            </label>
            <div *ngIf="fileInfo.exists" [@fadeIn] class="col-auto">
                <button type="button" class="btn btn-sm btn-danger px-4" data-bs-toggle="modal" data-bs-target="#uploadNameChange"><i class="bi bi-cloud-arrow-up-fill"></i></button>
            </div>
        </div>
        <div *ngIf="fileInfo.exists" [@slideInLeft] class="d-flex g-0 gap-1 px-2">
            <span class="badge bg-danger">{{fileInfo.name}}</span>
            <span class="badge bg-danger">{{fileInfo.size}}</span>
            <span class="badge bg-danger">{{fileInfo.extension}}</span>
        </div>
    </div>

    <div *ngIf="selected" class="modal fade bg-opacity-75 bg-light" id="confirmationDelete" tabindex="-1" aria-labelledby="confirmationDeleteLabel" aria-hidden="true">
        <div class="modal-dialog mt-5">
            <div *ngIf="selected.isFile; then isFile; else isFolder"></div>
        </div>
    </div>
    
    <div class="modal fade bg-opacity-75 bg-light" id="uploadNameChange" tabindex="-1" aria-labelledby="uploadNameChangeLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger border-0">
                    <h5 class="modal-title text-light" id="uploadNameChangeLabel">Subida de archivo</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div *ngIf="fileInfo.exists" class="d-flex gap-1 mb-2">
                            <span class="badge bg-danger">{{fileInfo.name}}</span>
                            <span class="badge bg-danger">{{fileInfo.size}}</span>
                        </div>
                        <p class="text-danger my-0"><i class="bi bi-info-square-fill me-2"></i>Puedes cambiar el nombre del archivo y añadirle una versión.</p>
                        <div class="d-grid mx-1 mt-2">
                            <div class="form-check form-switch">
                                <input #editNewNameCheckBox (change)="togglecheckBoxBoolean()" class="form-check-input" type="checkbox" role="switch">
                                <label class="form-check-label" for="editNewNameCheckBox">Editar nombre</label>
                            </div>
                        </div>
                        <div class="d-grid mt-2 mx-1">
                            <div *ngIf="checkBoxBoolean; then checkBoxBooleanIsTrue; else checkBoxBooleanIsFalse"></div>
                        </div>
                    </div>
                    <div class="row gap-2 mt-3 mx-1">
                        <button type="button" class="col d-grid btn btn-sm btn-danger" (click)="uploadFile()">Subir</button>
                        <button type="button" class="col d-grid btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bg-opacity-75 bg-light" id="makeDirectoryModal" tabindex="-1" aria-labelledby="makeDirectoryModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger border-0">
                    <h5 class="modal-title text-light" id="makeDirectoryModalLabel">Crear una carpeta</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="row p-0 m-0" [formGroup]="makeDirectoryForm">
                        <p class="text-danger mx-0 my-1"><i class="bi bi-info-square-fill me-2"></i>No puedes crear carpetas con nombres iguales.</p>
                        <p class="text-danger mx-0 my-1"><i class="bi bi-info-square-fill me-2"></i>Mínimo 4 caracteres, sin números ni símbolos.</p>
                        <span class="p-0 ms-2 mt-1">Nombre de la carpeta</span>
                        <input class="form-control" type="text" formControlName="directory" id="directoryName" placeholder="Introduce el nombre de la carpeta" (input)="checkFolderName()" autocomplete="off">
                        <div *ngIf="makeDirectoryForm.controls['directory']?.errors && makeDirectoryForm.controls['directory'].invalid; then invalid; else valid;" (change)="checkFolderName()"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

<notifier-container></notifier-container>

<ng-template #isFile>
    <div class="modal-content">
        <div class="modal-header bg-danger border-0">
            <h5 class="modal-title text-light" id="confirmationDeleteLabel">¿Deseas eliminar este archivo?</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
            <p class="m-0">Vas a eliminar el archivo:</p>
            <span *ngIf="selected.element" class="badge bg-light text-danger">{{ selected.element }}</span>
            <div class="row gap-2 mt-3 mx-2">
                <button type="button" class="col d-grid btn btn-sm btn-danger" (click)="deleteFile(selected.element)">Eliminar</button>
                <button type="button" class="col d-grid btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #isFolder>
    <div class="modal-content">
        <div class="modal-header bg-danger border-0">
            <h5 class="modal-title text-light" id="confirmationDeleteLabel">¿Deseas eliminar esta carpeta?</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
            <p class="m-0">Vas a eliminar la carpeta:</p>
            <span *ngIf="selected.element" class="badge bg-light text-danger">{{ selected.element }}</span>
            <div class="row gap-2 mt-3 mx-2">
                <button type="button" class="col d-grid btn btn-sm btn-danger" (click)="deleteFolder(selected.element)">Eliminar</button>
                <button type="button" class="col d-grid btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #invalid>
    <span [@fadeIn] class="p-0 mt-2 text-danger"><i class="bi bi-x me-1"></i>Esta nombre no es válido.</span>
    <div class="row g-0 gap-2 mt-3">
        <button type="button" class="col d-grid btn btn-sm btn-danger" disabled>Crear</button>
        <button type="button" class="col d-grid btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    </div>
</ng-template>

<ng-template #valid>
    <span [@fadeIn] class="p-0 mt-2 text-success"><i class="bi bi-check-lg me-1"></i>Puedes crear la carpeta</span>
    <div class="row g-0 gap-2 mt-3">
        <button type="button" class="col d-grid btn btn-sm btn-danger" (click)="makeDirectory()">Crear</button>
        <button type="button" class="col d-grid btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    </div>
</ng-template>

<ng-template #checkBoxBooleanIsTrue>
    <input type="text" class="form-control" #newName placeholder="{{fileInfo.name || 'Introduce el nombre'}}">
    <p [@fadeIn] class="text-danger my-0 mt-1"><i class="bi bi-exclamation-triangle-fill me-2"></i>Si el nombre del archivo coincide con otro, se sobreescribira.</p>
</ng-template>

<ng-template #checkBoxBooleanIsFalse>
    <input type="text" class="form-control" #newName placeholder="{{fileInfo.name || 'Introduce el nombre'}}" disabled>
</ng-template>